{% extends 'base.html' %}
{% load static %}

{% block title %}Verify Identity - VoteHub{% endblock %}

{% block extra_css %}
<style>
    .auth-container {
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 80vh;
        padding: 2rem 0;
    }

    .form-header {
        text-align: center;
        margin-bottom: 2.5rem;
    }

    .otp-display {
        background: rgba(255, 255, 255, 0.05);
        padding: 1.5rem;
        border-radius: 20px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        text-align: center;
        margin-bottom: 2rem;
    }

    .otp-input {
        text-align: center;
        font-size: 2.5rem;
        letter-spacing: 0.8rem;
        font-weight: 700;
        background: transparent !important;
        border: none !important;
        border-bottom: 3px solid var(--primary-color) !important;
        border-radius: 0 !important;
        width: 100%;
        color: white;
        margin: 1.5rem 0;
    }

    .otp-input:focus {
        box-shadow: none !important;
        border-bottom-color: white !important;
    }

    .timer-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.4rem 1rem;
        background: rgba(255, 255, 255, 0.05);
        border-radius: 100px;
        font-size: 0.85rem;
        color: var(--text-dim);
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <div class="auth-container">
        <div class="glass-card" style="max-width: 500px; width: 100%;">
            <div class="form-header">
                <div style="font-size: 3rem; color: var(--primary-color); margin-bottom: 1rem;">
                    <i class="fas fa-envelope-open-text"></i>
                </div>
                <h1 style="font-size: 2.5rem; font-weight: 700; margin-bottom: 0.5rem;">Verify Portal</h1>
                <p style="color: var(--text-dim);">Identity confirmation for <strong>{{ email }}</strong></p>
            </div>

            <form method="post" action="{% url 'verify_otp' %}">
                {% csrf_token %}

                <div class="form-group" style="text-align: center;">
                    <label class="form-label" style="text-align: center;">Enter 6-Digit Verification Code</label>
                    <input type="text" name="otp" id="otp" class="otp-input" placeholder="••••••" maxlength="6"
                        pattern="\d{6}" required autocomplete="one-time-code">
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 1rem; margin-top: 1rem;">
                    Confirm & Proceed <i class="fas fa-check-circle"></i>
                </button>
            </form>

            <div
                style="text-align: center; margin-top: 3rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.05);">
                <div id="timer-container" class="timer-badge">
                    <i class="fas fa-clock"></i> Resend code in <span id="timer"
                        style="font-weight: 700; color: white; width: 25px;">60</span>s
                </div>

                <div id="resend-container" style="display: none;">
                    <p style="color: var(--text-dim); font-size: 0.95rem;">
                        Didn't get the code?
                        <a href="{% url 'resend_otp' %}"
                            style="color: var(--primary-color); font-weight: 700; text-decoration: none;">Resend OTP</a>
                    </p>
                </div>

                <p style="margin-top: 1.5rem;">
                    <a href="{% url 'register' %}"
                        style="color: var(--text-dim); font-size: 0.85rem; text-decoration: none;">
                        <i class="fas fa-arrow-rotate-left"></i> Start Registration Over
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    const otpInput = document.getElementById('otp');
    const timerSpan = document.getElementById('timer');
    const timerContainer = document.getElementById('timer-container');
    const resendContainer = document.getElementById('resend-container');

    let seconds = 60;
    otpInput.focus();

    // Numbers only
    otpInput.addEventListener('input', function (e) {
        this.value = this.value.replace(/[^0-9]/g, '');
        if (this.value.length === 6) {
            // Optional: Auto-submit maybe?
        }
    });

    const countdown = setInterval(() => {
        seconds--;
        timerSpan.textContent = seconds;
        if (seconds <= 0) {
            clearInterval(countdown);
            timerContainer.style.display = 'none';
            resendContainer.style.display = 'block';
        }
    }, 1000);
</script>
{% endblock %}