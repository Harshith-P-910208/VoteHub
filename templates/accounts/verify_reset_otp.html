{% extends 'base.html' %}
{% load static %}

{% block title %}Verify Reset Code - VoteHub{% endblock %}

{% block content %}
<div class="container">
    <div class="form-container">
        <div class="glass-card" style="max-width: 500px; margin: 3rem auto;">
            <div class="form-header">
                <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Verify Reset Code</h1>
                <p style="color: var(--text-secondary);">An OTP has been sent to <strong>{{ email }}</strong></p>
            </div>

            <form method="post" action="{% url 'verify_reset_otp' %}">
                {% csrf_token %}

                <div class="form-group">
                    <label for="otp" class="form-label">Enter 6-digit OTP</label>
                    <input type="text" name="otp" id="otp" class="form-input" placeholder="000000" maxlength="6"
                        pattern="\d{6}" required style="text-align: center; font-size: 1.5rem; letter-spacing: 0.5rem;">
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 1rem;">
                    Verify OTP
                </button>
            </form>

            <div
                style="text-align: center; margin-top: 2rem; padding-top: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1);">
                <p style="color: var(--text-secondary);" id="timer-container">
                    Wait <span id="timer">60</span>s to resend code
                </p>
                <p style="color: var(--text-secondary); display: none;" id="resend-container">
                    Didn't receive the code?
                    <a href="{% url 'resend_otp' %}" style="color: var(--accent); font-weight: 600;">Resend OTP</a>
                </p>
                <p style="color: var(--text-secondary); margin-top: 1rem;">
                    <a href="{% url 'forgot_password' %}" style="color: rgba(255,255,255,0.5); font-size: 0.9rem;">Back
                        to Password Reset</a>
                </p>
            </div>
        </div>
    </div>
</div>

<script>
    // Timer configuration
    let seconds = 60;
    const timerSpan = document.getElementById('timer');
    const timerContainer = document.getElementById('timer-container');
    const resendContainer = document.getElementById('resend-container');
    const otpInput = document.getElementById('otp');

    // Auto-focus on OTP input
    otpInput.focus();

    // Format OTP input (only allow numbers)
    otpInput.addEventListener('input', function (e) {
        this.value = this.value.replace(/[^0-9]/g, '');
    });

    // Countdown timer with visual feedback
    const countdown = setInterval(() => {
        seconds--;
        timerSpan.textContent = seconds;

        // Visual feedback when time is running out
        if (seconds <= 10) {
            timerSpan.style.color = '#ff6b6b';
            timerSpan.style.fontWeight = 'bold';
        }

        if (seconds <= 0) {
            clearInterval(countdown);
            timerContainer.style.display = 'none';
            resendContainer.style.display = 'block';
        }
    }, 1000);

    // Handle resend click with loading state
    const resendLink = document.querySelector('a[href*="resend_otp"]');
    if (resendLink) {
        resendLink.addEventListener('click', function (e) {
            // Show loading state
            this.innerHTML = '<span style="opacity: 0.7;">Sending...</span>';
            this.style.pointerEvents = 'none';
        });
    }

    // Auto-submit when 6 digits are entered
    otpInput.addEventListener('input', function () {
        if (this.value.length === 6) {
            // Optional: Auto-submit the form
            // this.form.submit();
        }
    });
</script>
{% endblock %}